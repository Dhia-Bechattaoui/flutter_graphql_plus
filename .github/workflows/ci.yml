name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  pana:
    name: Pana Score Analysis
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Dart
        uses: dart-lang/setup-dart@v1
        with:
          sdk: stable
      
      - name: Install pana
        run: dart pub global activate pana
      
      - name: Run pana
        run: dart pub global run pana --no-warning --source path .
      
      - name: Check pana score
        run: |
          SCORE=$(dart pub global run pana --no-warning --source path . 2>&1 | grep -oP 'Pana score: \K\d+' || echo "0")
          echo "Pana score: $SCORE"
          if [ "$SCORE" -lt 160 ]; then
            echo "Pana score is below 160 (current: $SCORE)"
            exit 1
          fi

